```html
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Portal Colaborativo</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <style>
    /* Reset e Base */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f4f6f9;
      color: #333;
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Login */
    .login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
    }

    .login-card {
      background: white;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      width: 100%;
      max-width: 400px;
      text-align: center;
    }

    .login-card h1 {
      margin-bottom: 20px;
      color: #2c3e50;
      font-size: 24px;
    }

    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #555;
      font-weight: 500;
    }

    .form-group input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      transition: border 0.3s;
    }

    .form-group input:focus {
      outline: none;
      border-color: #2575fc;
    }

    .btn {
      background: #2575fc;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
      width: 100%;
    }

    .btn:hover {
      background: #1a5bc4;
    }

    .error {
      color: #e74c3c;
      margin-top: 10px;
      font-size: 14px;
    }

    /* Painel Admin */
    .admin-panel, .reader-view {
      display: none;
      padding: 20px 0;
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 2px solid #e0e0e0;
    }

    .header h1 {
      color: #2c3e50;
      font-size: 28px;
    }

    .logout-btn {
      background: #e74c3c;
      padding: 8px 16px;
      font-size: 14px;
    }

    /* Admin Controls */
    .admin-controls {
      margin-bottom: 30px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .btn-primary {
      background: #2575fc;
    }

    .btn-success {
      background: #27ae60;
    }

    .btn-danger {
      background: #e74c3c;
    }

    .btn-warning {
      background: #f39c12;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 12px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }

    .close-modal {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 24px;
      cursor: pointer;
      color: #999;
    }

    .close-modal:hover {
      color: #333;
    }

    .modal-title {
      margin-bottom: 20px;
      color: #2c3e50;
      font-size: 20px;
      border-bottom: 1px solid #eee;
      padding-bottom: 10px;
    }

    /* Form Fields */
    .form-row {
      margin-bottom: 15px;
    }

    .form-row label {
      display: block;
      margin-bottom: 8px;
      color: #555;
      font-weight: 500;
    }

    .form-row input,
    .form-row select,
    .form-row textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
    }

    .form-row textarea {
      min-height: 100px;
      resize: vertical;
    }

    /* Section List Reorder */
    .reorder-list {
      list-style: none;
      margin: 15px 0;
    }

    .reorder-item {
      background: #f8f9fa;
      padding: 12px;
      margin-bottom: 8px;
      border-radius: 8px;
      border: 1px solid #e9ecef;
      cursor: move;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .reorder-item:hover {
      background: #e9ecef;
    }

    .drag-handle {
      cursor: move;
      color: #999;
      margin-right: 10px;
    }

    /* Content Preview */
    .content-preview {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      font-size: 14px;
    }

    /* Section Cards */
    .section-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      margin-bottom: 20px;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .section-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .section-header {
      background: #2575fc;
      color: white;
      padding: 15px 20px;
      font-size: 18px;
      font-weight: 600;
    }

    .section-body {
      padding: 20px;
    }

    /* Meta Progress */
    .progress-container {
      margin: 15px 0;
    }

    .progress-bar-outer {
      height: 20px;
      background: #ecf0f1;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 8px;
    }

    .progress-bar-inner {
      height: 100%;
      background: linear-gradient(90deg, #27ae60, #2ecc71);
      border-radius: 10px;
      transition: width 0.5s ease;
      width: 0%;
    }

    .progress-text {
      text-align: right;
      font-size: 14px;
      color: #7f8c8d;
    }

    /* Tabelas e Listas */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    th {
      background: #f8f9fa;
      font-weight: 600;
      color: #2c3e50;
    }

    tr:hover {
      background: #f8f9fa;
    }

    .list-item {
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }

    .list-item:last-child {
      border-bottom: none;
    }

    /* Enquete */
    .poll-option {
      display: flex;
      align-items: center;
      margin: 10px 0;
    }

    .poll-option input[type="radio"] {
      margin-right: 10px;
    }

    .poll-results {
      margin-top: 15px;
      font-size: 14px;
    }

    .poll-result-bar {
      height: 20px;
      background: #ecf0f1;
      border-radius: 10px;
      margin: 5px 0;
      overflow: hidden;
    }

    .poll-result-fill {
      height: 100%;
      background: #3498db;
      border-radius: 10px;
    }

    /* Sugestões */
    .suggestion-form {
      margin: 15px 0;
    }

    .suggestion-form textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
      min-height: 80px;
      margin-bottom: 10px;
    }

    .suggestion-thanks {
      color: #27ae60;
      font-size: 14px;
      margin-top: 10px;
      display: none;
    }

    /* Responsividade */
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }

      .login-card {
        padding: 30px 20px;
      }

      .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }

      .admin-controls {
        flex-direction: column;
      }

      th, td {
        padding: 8px 6px;
        font-size: 14px;
      }
    }

    /* Icons (simples) */
    .icon {
      display: inline-block;
      width: 20px;
      height: 20px;
      background-size: contain;
      background-repeat: no-repeat;
      margin-right: 5px;
    }
  </style>
</head>
<body>
  <!-- Tela de Login -->
  <div id="loginScreen" class="login-container">
    <div class="login-card">
      <h1>Portal Colaborativo</h1>
      <div class="form-group">
        <label for="username">Nome</label>
        <input type="text" id="username" placeholder="Digite seu nome" />
      </div>
      <div class="form-group">
        <label for="password">Senha</label>
        <input type="password" id="password" placeholder="Digite sua senha" />
      </div>
      <button id="loginBtn" class="btn">Entrar</button>
      <div id="loginError" class="error"></div>
    </div>
  </div>

  <!-- Painel Admin -->
  <div id="adminPanel" class="admin-panel container">
    <div class="header">
      <h1>Painel Administrativo</h1>
      <button id="logoutBtn" class="btn logout-btn">Sair</button>
    </div>

    <div class="admin-controls">
      <button id="addSectionBtn" class="btn btn-primary">Criar Nova Seção</button>
      <button id="reorderSectionsBtn" class="btn btn-warning">Reordenar Seções</button>
    </div>

    <div id="sectionsList"></div>
  </div>

  <!-- Visualização do Leitor -->
  <div id="readerView" class="reader-view container">
    <div class="header">
      <h1>Mural de Informações</h1>
      <button id="logoutBtnReader" class="btn logout-btn">Sair</button>
    </div>

    <div id="muralContent"></div>
  </div>

  <!-- Modal para Criar/Editar Seção -->
  <div id="sectionModal" class="modal">
    <div class="modal-content">
      <span class="close-modal">&times;</span>
      <h2 class="modal-title">Criar Nova Seção</h2>
      <div class="form-row">
        <label for="sectionTitle">Título da Seção</label>
        <input type="text" id="sectionTitle" placeholder="Ex: Avisos Gerais" />
      </div>
      <div class="form-row">
        <label for="sectionType">Tipo de Conteúdo</label>
        <select id="sectionType">
          <option value="text">Texto Simples</option>
          <option value="table">Tabela (Plantonistas)</option>
          <option value="list">Lista (Folgas)</option>
          <option value="goal">Meta de Tarefas</option>
          <option value="poll">Enquete (estilo WhatsApp)</option>
          <option value="suggestion">Caixa de Sugestões</option>
        </select>
      </div>

      <!-- Texto -->
      <div id="contentTypeText" class="content-type">
        <div class="form-row">
          <label for="textContent">Conteúdo</label>
          <textarea id="textContent" placeholder="Digite o texto da seção..."></textarea>
        </div>
      </div>

      <!-- Tabela -->
      <div id="contentTypeTable" class="content-type" style="display:none;">
        <div class="form-row">
          <label>Adicionar Linha na Tabela</label>
          <div style="display:flex; gap:5px;">
            <input type="text" id="tableNome" placeholder="Nome" style="flex:2" />
            <input type="text" id="tableProjeto" placeholder="Projeto" style="flex:2" />
            <input type="text" id="tableData" placeholder="Data" style="flex:1" />
            <button id="addTableRow" class="btn btn-success" style="flex:1">+</button>
          </div>
        </div>
        <table id="tablePreview">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Projeto</th>
              <th>Data</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="tableRows"></tbody>
        </table>
      </div>

      <!-- Lista -->
      <div id="contentTypeList" class="content-type" style="display:none;">
        <div class="form-row">
          <label>Adicionar Item na Lista</label>
          <div style="display:flex; gap:5px;">
            <input type="text" id="listNome" placeholder="Nome" style="flex:2" />
            <input type="text" id="listProjeto" placeholder="Projeto" style="flex:2" />
            <input type="text" id="listDia" placeholder="Dia" style="flex:1" />
            <button id="addListItem" class="btn btn-success" style="flex:1">+</button>
          </div>
        </div>
        <div id="listPreview"></div>
      </div>

      <!-- Meta -->
      <div id="contentTypeGoal" class="content-type" style="display:none;">
        <div class="form-row">
          <label for="goalTitle">Título da Meta</label>
          <input type="text" id="goalTitle" placeholder="Ex: Concluir Projeto X" />
        </div>
        <div class="form-row">
          <label for="goalCurrent">Progresso Atual</label>
          <input type="number" id="goalCurrent" min="0" placeholder="Tarefas concluídas" />
        </div>
        <div class="form-row">
          <label for="goalTotal">Total de Tarefas</label>
          <input type="number" id="goalTotal" min="1" placeholder="Total de tarefas" />
        </div>
        <div class="content-preview">
          <strong>Pré-visualização:</strong>
          <div id="goalPreview" class="progress-container">
            <div class="progress-bar-outer">
              <div class="progress-bar-inner" style="width: 0%"></div>
            </div>
            <div class="progress-text">0%</div>
          </div>
        </div>
      </div>

      <!-- Enquete -->
      <div id="contentTypePoll" class="content-type" style="display:none;">
        <div class="form-row">
          <label for="pollQuestion">Pergunta da Enquete</label>
          <input type="text" id="pollQuestion" placeholder="Qual será o próximo evento?" />
        </div>
        <div class="form-row">
          <label>Opções da Enquete</label>
          <div id="pollOptionsContainer">
            <div class="poll-option-input" style="display:flex; gap:5px; margin-bottom:5px;">
              <input type="text" placeholder="Opção 1" class="poll-option-field" style="flex:1" />
              <button type="button" class="btn btn-danger remove-option" style="padding:5px 10px;">x</button>
            </div>
            <div class="poll-option-input" style="display:flex; gap:5px;">
              <input type="text" placeholder="Opção 2" class="poll-option-field" style="flex:1" />
              <button type="button" class="btn btn-danger remove-option" style="padding:5px 10px;">x</button>
            </div>
          </div>
          <button id="addPollOption" class="btn btn-success" style="margin:10px 0;">+ Adicionar Opção</button>
        </div>
      </div>

      <!-- Sugestão -->
      <div id="contentTypeSuggestion" class="content-type" style="display:none;">
        <p>Os colaboradores poderão enviar sugestões anônimas. Apenas você poderá visualizá-las no painel.</p>
        <div class="form-row">
          <label for="suggestionTitle">Título da Caixa de Sugestões</label>
          <input type="text" id="suggestionTitle" placeholder="Ex: Envie sua sugestão" />
        </div>
      </div>

      <button id="saveSectionBtn" class="btn btn-primary" style="margin-top:20px;">Salvar Seção</button>
    </div>
  </div>

  <!-- Modal de Reordenação -->
  <div id="reorderModal" class="modal">
    <div class="modal-content">
      <span class="close-modal">&times;</span>
      <h2 class="modal-title">Reordenar Seções</h2>
      <p>Arraste as seções para definir a ordem de exibição no mural.</p>
      <ul id="reorderList" class="reorder-list">
        <!-- Será preenchido dinamicamente -->
      </ul>
      <button id="saveOrderBtn" class="btn btn-primary" style="margin-top:20px;">Salvar Ordem</button>
    </div>
  </div>

  <script>
    // Configuração do Firebase (substitua com suas credenciais no deploy)
    const firebaseConfig = {
      // Adicione suas configurações do Firebase aqui
      // Exemplo:
      // apiKey: "your-api-key",
      // authDomain: "your-project.firebaseapp.com",
      // databaseURL: "https://your-project-default-rtdb.firebaseio.com"
    };

    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Elementos DOM
    const loginScreen = document.getElementById('loginScreen');
    const adminPanel = document.getElementById('adminPanel');
    const readerView = document.getElementById('readerView');
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const logoutBtnReader = document.getElementById('logoutBtnReader');
    const addSectionBtn = document.getElementById('addSectionBtn');
    const reorderSectionsBtn = document.getElementById('reorderSectionsBtn');
    const sectionModal = document.getElementById('sectionModal');
    const reorderModal = document.getElementById('reorderModal');
    const closeModal = document.querySelectorAll('.close-modal');
    const sectionType = document.getElementById('sectionType');
    const contentTypes = document.querySelectorAll('.content-type');
    const saveSectionBtn = document.getElementById('saveSectionBtn');
    const saveOrderBtn = document.getElementById('saveOrderBtn');

    // Variáveis de estado
    let currentUser = null;
    let sections = {};
    let editingSectionId = null;
    let currentTableRows = [];
    let currentListItems = [];

    // Inicialização
    window.onload = function() {
      // Verifica se já tem usuário logado (simulação básica)
      const savedUser = localStorage.getItem('currentUser');
      if (savedUser) {
        currentUser = JSON.parse(savedUser);
        showPanelBasedOnUser();
      }
    };

    // Login
    loginBtn.addEventListener('click', async () => {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      const errorDiv = document.getElementById('loginError');
      
      if (!username || !password) {
        errorDiv.textContent = 'Por favor, preencha todos os campos.';
        return;
      }

      try {
        const snapshot = await database.ref('usuarios').orderByChild('nome').equalTo(username).once('value');
        const users = snapshot.val();
        
        if (users) {
          const userKey = Object.keys(users)[0];
          const user = users[userKey];
          
          if (user.senha === password) {
            currentUser = user;
            currentUser.key = userKey;
            // Simulação de persistência (não usar localStorage em produção real)
            try {
              localStorage.setItem('currentUser', JSON.stringify(user));
            } catch(e) {
              console.warn('localStorage não disponível');
            }
            showPanelBasedOnUser();
            errorDiv.textContent = '';
          } else {
            errorDiv.textContent = 'Senha incorreta.';
          }
        } else {
            errorDiv.textContent = 'Usuário não encontrado.';
        }
      } catch (error) {
        console.error('Erro ao fazer login:', error);
        errorDiv.textContent = 'Erro ao conectar ao servidor.';
      }
    });

    // Mostrar painel com base no usuário
    function showPanelBasedOnUser() {
      loginScreen.style.display = 'none';
      if (currentUser.tipo === 'admin') {
        adminPanel.style.display = 'block';
        loadSections();
      } else {
        readerView.style.display = 'block';
        loadMuralContent();
      }
    }

    // Logout
    [logoutBtn, logoutBtnReader].forEach(btn => {
      btn.addEventListener('click', () => {
        currentUser = null;
        try {
          localStorage.removeItem('currentUser');
        } catch(e) {}
        loginScreen.style.display = 'flex';
        adminPanel.style.display = 'none';
        readerView.style.display = 'none';
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
      });
    });

    // Abrir modal de nova seção
    addSectionBtn.addEventListener('click', () => {
      resetModal();
      sectionModal.style.display = 'flex';
    });

    // Fechar modais
    closeModal.forEach(btn => {
      btn.addEventListener('click', () => {
        sectionModal.style.display = 'none';
        reorderModal.style.display = 'none';
      });
    });

    // Fechar modal ao clicar fora
    window.addEventListener('click', (e) => {
      if (e.target === sectionModal) sectionModal.style.display = 'none';
      if (e.target === reorderModal) reorderModal.style.display = 'none';
    });

    // Trocar tipo de conteúdo
    sectionType.addEventListener('change', function() {
      contentTypes.forEach(el => el.style.display = 'none');
      document.getElementById(`contentType${capitalizeFirst(this.value)}`).style.display = 'block';
      
      if (this.value === 'table') {
        renderTablePreview();
      } else if (this.value === 'list') {
        renderListPreview();
      } else if (this.value === 'goal') {
        updateGoalPreview();
      }
    });

    function capitalizeFirst(string) {
      return string.charAt(0).toUpperCase() + string.slice(1);
    }

    // Funções para tabelas
    document.getElementById('addTableRow').addEventListener('click', () => {
      const nome = document.getElementById('tableNome').value.trim();
      const projeto = document.getElementById('tableProjeto').value.trim();
      const data = document.getElementById('tableData').value.trim();
      
      if (nome && projeto && data) {
        currentTableRows.push({ nome, projeto, data });
        document.getElementById('tableNome').value = '';
        document.getElementById('tableProjeto').value = '';
        document.getElementById('tableData').value = '';
        renderTablePreview();
      }
    });

    function renderTablePreview() {
      const tbody = document.getElementById('tableRows');
      tbody.innerHTML = '';
      currentTableRows.forEach((row, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${row.nome}</td>
          <td>${row.projeto}</td>
          <td>${row.data}</td>
          <td><button class="btn btn-danger" onclick="removeTableRow(${index})">Remover</button></td>
        `;
        tbody.appendChild(tr);
      });
    }

    window.removeTableRow = function(index) {
      currentTableRows.splice(index, 1);
      renderTablePreview();
    };

    // Funções para listas
    document.getElementById('addListItem').addEventListener('click', () => {
      const nome = document.getElementById('listNome').value.trim();
      const projeto = document.getElementById('listProjeto').value.trim();
      const dia = document.getElementById('listDia').value.trim();
      
      if (nome && projeto && dia) {
        currentListItems.push({ nome, projeto, dia });
        document.getElementById('listNome').value = '';
        document.getElementById('listProjeto').value = '';
        document.getElementById('listDia').value = '';
        renderListPreview();
      }
    });

    function renderListPreview() {
      const container = document.getElementById('listPreview');
      container.innerHTML = '<strong>Pré-visualização:</strong><div>';
      currentListItems.forEach(item => {
        container.innerHTML += `
          <div class="list-item">
            <strong>${item.nome}</strong> - ${item.projeto} - ${item.dia}
            <button class="btn btn-danger" style="float:right; padding:2px 8px; font-size:12px;" 
                    onclick="removeListItem(${currentListItems.indexOf(item)})">x</button>
          </div>
        `;
      });
      container.innerHTML += '</div>';
    }

    window.removeListItem = function(index) {
      currentListItems.splice(index, 1);
      renderListPreview();
    };

    // Funções para metas
    ['goalCurrent', 'goalTotal'].forEach(id => {
      document.getElementById(id)?.addEventListener('input', updateGoalPreview);
    });

    function updateGoalPreview() {
      const current = parseInt(document.getElementById('goalCurrent').value) || 0;
      const total = parseInt(document.getElementById('goalTotal').value) || 1;
      const percent = Math.min(100, Math.round((current / total) * 100));
      
      const bar = document.querySelector('#goalPreview .progress-bar-inner');
      const text = document.querySelector('#goalPreview .progress-text');
      
      if (bar && text) {
        bar.style.width = `${percent}%`;
        text.textContent = `${percent}% (${current}/${total})`;
      }
    }

    // Funções para enquetes
    document.getElementById('addPollOption').addEventListener('click', () => {
      const container = document.getElementById('pollOptionsContainer');
      const div = document.createElement('div');
      div.className = 'poll-option-input';
      div.style = 'display:flex; gap:5px; margin-bottom:5px;';
      div.innerHTML = `
        <input type="text" placeholder="Nova opção" class="poll-option-field" style="flex:1" />
        <button type="button" class="btn btn-danger remove-option" style="padding:5px 10px;">x</button>
      `;
      container.appendChild(div);
    });

    // Remover opção de enquete
    document.getElementById('pollOptionsContainer').addEventListener('click', (e) => {
      if (e.target.classList.contains('remove-option')) {
        const container = e.target.closest('.poll-option-input');
        if (document.querySelectorAll('.poll-option-input').length > 2) {
          container.remove();
        }
      }
    });

    // Reordenar seções
    reorderSectionsBtn.addEventListener('click', () => {
      loadSectionsForReorder();
      reorderModal.style.display = 'flex';
    });

    function loadSectionsForReorder() {
      const list = document.getElementById('reorderList');
      list.innerHTML = '';
      
      // Ordenar seções pela ordem
      const orderedSections = Object.entries(sections)
        .sort((a, b) => (a[1].ordem || 0) - (b[1].ordem || 0));
      
      orderedSections.forEach(([id, section]) => {
        const li = document.createElement('li');
        li.className = 'reorder-item';
        li.dataset.id = id;
        li.innerHTML = `
          <span class="drag-handle">☰</span>
          <span>${section.titulo}</span>
        `;
        list.appendChild(li);
      });
      
      // Iniciar arrastar e soltar
      initDragAndDrop();
    }

    function initDragAndDrop() {
      const list = document.getElementById('reorderList');
      let draggedItem = null;

      list.addEventListener('dragstart', (e) => {
        draggedItem = e.target;
        e.dataTransfer.effectAllowed = 'move';
        setTimeout(() => e.target.classList.add('dragging'), 0);
      });

      list.addEventListener('dragend', (e) => {
        e.target.classList.remove('dragging');
        draggedItem = null;
      });

      list.addEventListener('dragover', (e) => {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
        const afterElement = getDragAfterElement(list, e.clientY);
        const curElement = document.querySelector('.dragging');
        if (afterElement == null) {
          list.appendChild(curElement);
        } else {
          list.insertBefore(curElement, afterElement);
        }
      });
    }

    function getDragAfterElement(container, y) {
      const draggableElements = [...container.querySelectorAll('.reorder-item:not(.dragging)')];
      return draggableElements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height / 2;
        if (offset < 0 && offset > closest.offset) {
          return { offset: offset, element: child };
        } else {
          return closest;
        }
      }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

    // Salvar ordem
    saveOrderBtn.addEventListener('click', () => {
      const items = document.querySelectorAll('#reorderList .reorder-item');
      const updates = {};
      
      items.forEach((item, index) => {
        const sectionId = item.dataset.id;
        updates[`secoes/${sectionId}/ordem`] = index;
      });
      
      database.ref().update(updates)
        .then(() => {
          reorderModal.style.display = 'none';
          loadSections(); // Atualiza imediatamente
        })
        .catch(error => {
          console.error('Erro ao salvar ordem:', error);
          alert('Erro ao salvar ordem das seções.');
        });
    });

    // Salvar seção
    saveSectionBtn.addEventListener('click', () => {
      const title = document.getElementById('sectionTitle').value.trim();
      const type = sectionType.value;
      
      if (!title) {
        alert('Por favor, insira um título para a seção.');
        return;
      }

      const newSection = {
        titulo: title,
        tipo: type,
        ordem: Object.keys(sections).length
      };

      // Conteúdo específico por tipo
      switch (type) {
        case 'text':
          const textContent = document.getElementById('textContent').value.trim();
          if (!textContent) {
            alert('Por favor, insira o conteúdo da seção.');
            return;
          }
          newSection.conteudo = { texto: textContent };
          break;

        case 'table':
          if (currentTableRows.length === 0) {
            alert('Por favor, adicione pelo menos uma linha na tabela.');
            return;
          }
          newSection.conteudo = { linhas: currentTableRows };
          break;

        case 'list':
          if (currentListItems.length === 0) {
            alert('Por favor, adicione pelo menos um item na lista.');
            return;
          }
          newSection.conteudo = { itens: currentListItems };
          break;

        case 'goal':
          const current = parseInt(document.getElementById('goalCurrent').value);
          const total = parseInt(document.getElementById('goalTotal').value);
          if (isNaN(current) || isNaN(total) || total <= 0) {
            alert('Por favor, insira valores válidos para a meta.');
            return;
          }
          newSection.conteudo = { 
            titulo: document.getElementById('goalTitle').value || 'Nova Meta',
            atual: current,
            total: total
          };
          break;

        case 'poll':
          const question = document.getElementById('pollQuestion').value.trim();
          const options = Array.from(document.querySelectorAll('.poll-option-field'))
            .map(el => el.value.trim())
            .filter(opt => opt);
          
          if (!question || options.length < 2) {
            alert('Por favor, insira uma pergunta e pelo menos duas opções para a enquete.');
            return;
          }
          
          newSection.conteudo = { 
            pergunta: question,
            opcoes: options.map(opt => ({ texto: opt, votos: 0 }))
          };
          break;

        case 'suggestion':
          newSection.conteudo = { 
            titulo: document.getElementById('suggestionTitle').value || 'Caixa de Sugestões',
            sugestoes: []
          };
          break;
      }

      const updates = {};
      const sectionRef = editingSectionId ? 
        `secoes/${editingSectionId}` : 
        `secoes/${database.ref().push().key}`;
      
      updates[sectionRef] = newSection;
      database.ref().update(updates)
        .then(() => {
          sectionModal.style.display = 'none';
          resetModal();
          if (editingSectionId) {
            editingSectionId = null;
          }
        })
        .catch(error => {
          console.error('Erro ao salvar seção:', error);
          alert('Erro ao salvar seção.');
        });
    });

    // Resetar modal
    function resetModal() {
      document.getElementById('sectionTitle').value = '';
      sectionType.value = 'text';
      document.getElementById('textContent').value = '';
      currentTableRows = [];
      currentListItems = [];
      document.getElementById('goalTitle').value = '';
      document.getElementById('goalCurrent').value = '';
      document.getElementById('goalTotal').value = '';
      document.getElementById('pollQuestion').value = '';
      const optionsContainer = document.getElementById('pollOptionsContainer');
      optionsContainer.innerHTML = `
        <div class="poll-option-input" style="display:flex; gap:5px; margin-bottom:5px;">
          <input type="text" placeholder="Opção 1" class="poll-option-field" style="flex:1" />
          <button type="button" class="btn btn-danger remove-option" style="padding:5px 10px;">x</button>
        </div>
        <div class="poll-option-input" style="display:flex; gap:5px;">
          <input type="text" placeholder="Opção 2" class="poll-option-field" style="flex:1" />
          <button type="button" class="btn btn-danger remove-option" style="padding:5px 10px;">x</button>
        </div>
      `;
      document.getElementById('suggestionTitle').value = '';
      
      contentTypes.forEach(el => el.style.display = 'none');
      document.getElementById('contentTypeText').style.display = 'block';
    }

    // Carregar seções (admin)
    function loadSections() {
      database.ref('secoes').on('value', (snapshot) => {
        sections = snapshot.val() || {};
        const container = document.getElementById('sectionsList');
        container.innerHTML = '';

        // Ordenar por 'ordem'
        const orderedSections = Object.entries(sections)
          .sort((a, b) => (a[1].ordem || 0) - (b[1].ordem || 0));

        orderedSections.forEach(([id, section]) => {
          const sectionEl = document.createElement('div');
          sectionEl.className = 'section-card';
          sectionEl.innerHTML = `
            <div class="section-header">
              ${section.titulo}
              <span style="float:right; font-size:14px; opacity:0.8;">(${section.tipo})</span>
            </div>
            <div class="section-body">
              ${renderAdminPreview(section)}
              <div style="margin-top:15px; text-align:right;">
                <button class="btn btn-success edit-section" data-id="${id}">Editar</button>
                <button class="btn btn-danger delete-section" data-id="${id}">Excluir</button>
              </div>
            </div>
          `;
          container.appendChild(sectionEl);
        });

        // Eventos de edição e exclusão
        document.querySelectorAll('.edit-section').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const id = e.target.dataset.id;
            editSection(id);
          });
        });

        document.querySelectorAll('.delete-section').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const id = e.target.dataset.id;
            deleteSection(id);
          });
        });
      });
    }

    function renderAdminPreview(section) {
      switch (section.tipo) {
        case 'text':
          return `<p>${section.conteudo.texto?.replace(/\n/g, '<br>') || 'Sem conteúdo'}</p>`;
        
        case 'table':
          if (!section.conteudo.linhas || section.conteudo.linhas.length === 0) {
            return '<p>Sem dados na tabela.</p>';
          }
          let tableHtml = '<table><thead><tr><th>Nome</th><th>Projeto</th><th>Data</th></tr></thead><tbody>';
          section.conteudo.linhas.forEach(row => {
            tableHtml += `<tr><td>${row.nome}</td><td>${row.projeto}</td><td>${row.data}</td></tr>`;
          });
          tableHtml += '</tbody></table>';
          return tableHtml;

        case 'list':
          if (!section.conteudo.itens || section.conteudo.itens.length === 0) {
            return '<p>Sem itens na lista.</p>';
          }
          let listHtml = '<div>';
          section.conteudo.itens.forEach(item => {
            listHtml += `<div class="list-item"><strong>${item.nome}</strong> - ${item.projeto} - ${item.dia}</div>`;
          });
          listHtml += '</div>';
          return listHtml;

        case 'goal':
          const goal = section.conteudo;
          const percent = Math.min(100, Math.round((goal.atual / goal.total) * 100));
          return `
            <p><strong>${goal.titulo}</strong></p>
            <div class="progress-container">
              <div class="progress-bar-outer">
                <div class="progress-bar-inner" style="width: ${percent}%"></div>
              </div>
              <div class="progress-text">${percent}% (${goal.atual}/${goal.total})</div>
            </div>
          `;

        case 'poll':
          const poll = section.conteudo;
          let pollHtml = `<p><strong>${poll.pergunta}</strong></p><div>`;
          poll.opcoes.forEach((opt, index) => {
            pollHtml += `
              <div class="poll-option">
                <input type="radio" name="poll-${section.titulo}" id="opt-${index}" disabled>
                <label for="opt-${index}">${opt.texto}</label>
              </div>
            `;
          });
          pollHtml += '</div>';
          return pollHtml;

        case 'suggestion':
          return `
            <p>${section.conteudo.titulo}</p>
            <p><em>Os colaboradores podem enviar sugestões. Você poderá visualizá-las no painel administrativo.</em></p>
            <div id="suggestions-${section.titulo}" style="margin-top:10px; max-height:200px; overflow-y:auto; border:1px solid #eee; padding:10px; display:none;">
              <!-- Será preenchido com sugestões -->
            </div>
          `;

        default:
          return '<p>Conteúdo não suportado.</p>';
      }
    }

    // Editar seção
    function editSection(id) {
      const section = sections[id];
      if (!section) return;

      editingSectionId = id;
      document.getElementById('sectionTitle').value = section.titulo;
      sectionType.value = section.tipo;

      // Resetar conteúdos
      currentTableRows = [];
      currentListItems = [];

      // Preencher campos
      switch (section.tipo) {
        case 'text':
          document.getElementById('textContent').value = section.conteudo.texto || '';
          break;

        case 'table':
          currentTableRows = [...(section.conteudo.linhas || [])];
          renderTablePreview();
          break;

        case 'list':
          currentListItems = [...(section.conteudo.itens || [])];
          renderListPreview();
          break;

        case 'goal':
          document.getElementById('goalTitle').value = section.conteudo.titulo || '';
          document.getElementById('goalCurrent').value = section.conteudo.atual || 0;
          document.getElementById('goalTotal').value = section.conteudo.total || 1;
          updateGoalPreview();
          break;

        case 'poll':
          document.getElementById('pollQuestion').value = section.conteudo.pergunta || '';
          const container = document.getElementById('pollOptionsContainer');
          container.innerHTML = '';
          (section.conteudo.opcoes || []).forEach(opt => {
            const div = document.createElement('div');
            div.className = 'poll-option-input';
            div.style = 'display:flex; gap:5px; margin-bottom:5px;';
            div.innerHTML = `
              <input type="text" value="${opt.texto}" class="poll-option-field" style="flex:1" />
              <button type="button" class="btn btn-danger remove-option" style="padding:5px 10px;">x</button>
            `;
            container.appendChild(div);
          });
          break;

        case 'suggestion':
          document.getElementById('suggestionTitle').value = section.conteudo.titulo || '';
          break;
      }

      // Mostrar conteúdo correto
      contentTypes.forEach(el => el.style.display = 'none');
      document.getElementById(`contentType${capitalizeFirst(section.tipo)}`).style.display = 'block';

      // Abrir modal
      sectionModal.style.display = 'flex';
    }

    // Excluir seção
    function deleteSection(id) {
      if (confirm('Tem certeza que deseja excluir esta seção?')) {
        database.ref(`secoes/${id}`).remove()
          .then(() => {
            // Atualizar ordens
            const remainingSections = Object.entries(sections)
              .filter(([key]) => key !== id)
              .sort((a, b) => (a[1].ordem || 0) - (b[1].ordem || 0));
            
            const updates = {};
            remainingSections.forEach(([secId, sec], index) => {
              updates[`secoes/${secId}/ordem`] = index;
            });
            
            return database.ref().update(updates);
          })
          .catch(error => {
            console.error('Erro ao excluir seção:', error);
            alert('Erro ao excluir seção.');
          });
      }
    }

    // Carregar mural (leitor)
    function loadMuralContent() {
      database.ref('secoes').on('value', (snapshot) => {
        const data = snapshot.val() || {};
        const container = document.getElementById('muralContent');
        container.innerHTML = '';

        // Ordenar por 'ordem'
        const orderedSections = Object.entries(data)
          .sort((a, b) => (a[1].ordem || 0) - (b[1].ordem || 0));

        orderedSections.forEach(([id, section]) => {
          const sectionEl = document.createElement('div');
          sectionEl.className = 'section-card';
          sectionEl.innerHTML = `
            <div class="section-header">${section.titulo}</div>
            <div class="section-body">${renderReaderContent(section, id)}</div>
          `;
          container.appendChild(sectionEl);
        });
      });
    }

    function renderReaderContent(section, sectionId) {
      switch (section.tipo) {
        case 'text':
          return `<p>${section.conteudo.texto?.replace(/\n/g, '<br>') || 'Sem conteúdo'}</p>`;
        
        case 'table':
          if (!section.conteudo.linhas || section.conteudo.linhas.length === 0) {
            return '<p>Sem dados disponíveis.</p>';
          }
          let tableHtml = '<table><thead><tr><th>Nome</th><th>Projeto</th><th>Data</th></tr></thead><tbody>';
          section.conteudo.linhas.forEach(row => {
            tableHtml += `<tr><td>${row.nome}</td><td>${row.projeto}</td><td>${row.data}</td></tr>`;
          });
          tableHtml += '</tbody></table>';
          return tableHtml;

        case 'list':
          if (!section.conteudo.itens || section.conteudo.itens.length === 0) {
            return '<p>Sem itens disponíveis.</p>';
          }
          let listHtml = '<div>';
          section.conteudo.itens.forEach(item => {
            listHtml += `<div class="list-item"><strong>${item.nome}</strong> - ${item.projeto} - ${item.dia}</div>`;
          });
          listHtml += '</div>';
          return listHtml;

        case 'goal':
          const goal = section.conteudo;
          const percent = Math.min(100, Math.round((goal.atual / goal.total) * 100));
          return `
            <p><strong>${goal.titulo}</strong></p>
            <div class="progress-container">
              <div class="progress-bar-outer">
                <div class="progress-bar-inner" style="width: ${percent}%"></div>
              </div>
              <div class="progress-text">${percent}% (${goal.atual}/${goal.total})</div>
            </div>
          `;

        case 'poll':
          const poll = section.conteudo;
          let pollHtml = `<p><strong>${poll.pergunta}</strong></p><div id="poll-${sectionId}">`;
          poll.opcoes.forEach((opt, index) => {
            pollHtml += `
              <div class="poll-option">
                <input type="radio" name="poll-${sectionId}" id="poll-${sectionId}-opt${index}" 
                       data-index="${index}" onchange="votePoll('${sectionId}', ${index})">
                <label for="poll-${sectionId}-opt${index}">${opt.texto}</label>
              </div>
            `;
          });
          pollHtml += `
            </div>
            <div class="poll-results" id="poll-results-${sectionId}" style="display:none;">
              <strong>Resultados:</strong>
              <div id="poll-bars-${sectionId}"></div>
              <div>Total de votos: <span id="poll-total-${sectionId}">0</span></div>
            </div>
            <button class="btn btn-success" onclick="showPollResults('${sectionId}')" 
                    id="show-results-${sectionId}" style="margin-top:10px;">Ver Resultados</button>
          `;
          return pollHtml;

        case 'suggestion':
          return `
            <p>${section.conteudo.titulo}</p>
            <div class="suggestion-form">
              <textarea id="suggestionText-${sectionId}" placeholder="Digite sua sugestão aqui..."></textarea>
              <button class="btn btn-primary" onclick="submitSuggestion('${sectionId}')">Enviar Sugestão</button>
              <div class="suggestion-thanks" id="suggestionThanks-${sectionId}">Sugestão enviada com sucesso! Obrigado.</div>
            </div>
          `;

        default:
          return '<p>Conteúdo não disponível.</p>';
      }
    }

    // Votar em enquete
    window.votePoll = function(sectionId, optionIndex) {
      const sectionRef = database.ref(`secoes/${sectionId}`);
      sectionRef.transaction(currentSection => {
        if (currentSection && currentSection.conteudo.opcoes[optionIndex]) {
          currentSection.conteudo.opcoes[optionIndex].votos += 1;
        }
        return currentSection;
      }).then(() => {
        // Desabilitar opções após votar
        document.querySelectorAll(`#poll-${sectionId} input[type="radio"]`).forEach(radio => {
          radio.disabled = true;
        });
        alert('Voto registrado com sucesso!');
      });
    };

    // Mostrar resultados da enquete
    window.showPollResults = function(sectionId) {
      const sectionRef = database.ref(`secoes/${sectionId}`);
      sectionRef.once('value', (snapshot) => {
        const section = snapshot.val();
        if (!section || section.tipo !== 'poll') return;

        const resultsContainer = document.getElementById(`poll-results-${sectionId}`);
        const barsContainer = document.getElementById(`poll-bars-${sectionId}`);
        const totalSpan = document.getElementById(`poll-total-${sectionId}`);
        
        let totalVotes = 0;
        section.conteudo.opcoes.forEach(opt => {
          totalVotes += opt.votos || 0;
        });

        barsContainer.innerHTML = '';
        section.conteudo.opcoes.forEach(opt => {
          const percent = totalVotes > 0 ? (opt.votos / totalVotes) * 100 : 0;
          barsContainer.innerHTML += `
            <div>${opt.texto}: ${opt.votos} voto(s)</div>
            <div class="poll-result-bar">
              <div class="poll-result-fill" style="width: ${percent}%"></div>
            </div>
          `;
        });

        totalSpan.textContent = totalVotes;
        resultsContainer.style.display = 'block';
        document.getElementById(`show-results-${sectionId}`).style.display = 'none';
      });
    };

    // Enviar sugestão
    window.submitSuggestion = function(sectionId) {
      const textArea = document.getElementById(`suggestionText-${sectionId}`);
      const text = textArea.value.trim();
      if (!text) {
        alert('Por favor, digite sua sugestão.');
        return;
      }

      const suggestionRef = database.ref(`secoes/${sectionId}/conteudo/sugestoes`).push();
      suggestionRef.set({
        texto: text,
        timestamp: firebase.database.ServerValue.TIMESTAMP,
        colaborador: currentUser.nome || 'Anônimo'
      }).then(() => {
        textArea.value = '';
        document.getElementById(`suggestionThanks-${sectionId}`).style.display = 'block';
        setTimeout(() => {
          document.getElementById(`suggestionThanks-${sectionId}`).style.display = 'none';
        }, 3000);
      }).catch(error => {
        console.error('Erro ao enviar sugestão:', error);
        alert('Erro ao enviar sugestão.');
      });
    };

    // Inicializar com tipo de texto
    document.getElementById('contentTypeText').style.display = 'block';
  </script>
</body>
</html>
```
